<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PyScript Fetch Example</title>
        <!-- PyScript CSS -->
    <link rel="stylesheet" href="https://pyscript.net/releases/2024.1.1/core.css">

    <!-- This script tag bootstraps PyScript -->
    <script type="module" src="https://pyscript.net/releases/2024.1.1/core.js"></script>

    <!-- for splashscreen -->
    <style>
        #loading { outline: none; border: none; background: transparent }
    </style>
    
    <!-- <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css"> -->
    <!-- <script defer src="https://pyscript.net/latest/pyscript.js"></script> -->
    <script type="module">
        const loading = document.getElementById('loading');
        addEventListener('py:ready', () => loading.close());
        loading.showModal();
    </script>
</head>
<body>
    <h1>PyScriptでファイルを取得</h1>
    <button id="fetch-button">ファイルを取得</button>
    <pre id="output"></pre>
    <pre id="out1">loading</pre>
    <section class="pyscript">
    <script type="py">
        from js import fetch, console

        async def fetch_file():
            response = await fetch('./04_pys_fetch.html')  # 取得したいファイルのパス
            if response.ok:
                text = await response.text()
                console.log(text)  # コンソールに出力
                output_element = Element('output')
                output_element.element.innerText = text  # 取得した内容を表示
            else:
                console.log('ファイルの取得に失敗しました。')

        def on_button_click(event):
            fetch_file()

        # ボタンにクリックイベントを追加
        button = Element('fetch-button')
        button.element.onclick = on_button_click
        ele_o1 = Element('out1')
        ele_o1.element.innerText = 'started'
    </script>
    </section>
</body>
</html>
